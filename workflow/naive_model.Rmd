---
title: "Projet M2 2022-23"
subtitle: 'Modèles pour la régression'
author: "Mettre vos noms ICI"
output: 
  pdf_document: 
    keep_tex: no
fontsize: 12pt    
header-includes:
- \usepackage{pifont}
- \usepackage{manfnt}
- \usepackage{mdframed}
- \usepackage{systeme}
- \usepackage{txfonts}
- \newcommand{\cH}{\mathcal{H}}

params:
  path_data_folder: "../data/"
  path_R_folder: "../R/"
---

# Parameters
```{r setup, include=FALSE}
knitr::opts_chunk$set(fig.align = 'center', warning=FALSE,message=FALSE)

source(paste(params$path_R_folder,"libraries.R", sep=''))
source(paste(params$path_R_folder,"functions.R", sep=''))
source(paste(params$path_R_folder,"preprocessing.R", sep=''))
set.seed(2022)

init_train <- read.csv2(paste(params$path_data_folder, "train.csv",sep=''),
                   header=TRUE, 
                   sep=",")
init_test <- read.csv2(paste(params$path_data_folder, "test.csv", sep=''), 
                  header=TRUE, 
                  sep=",")

target <- 'SalePrice'
train <- set_numerics(init_train, num_vars)
```


# No modification

### lm
```{r}
model = lm(SalePrice ~., data = init_train)
model %>% summary

model_pred <- model %>%
  predict(newdata=init_test)

RMSE(model_pred, init_test$SalePrice)
```

### stepAIC
```{r}
model0 <- lm(SalePrice~1, train)
model <- stepAIC(model0, direction="forward", trace=TRUE)

model_pred <- predict(model, newdata=test)

RMSE(model_pred, test$SalePrice)
```
```{r}

```


# Only numeric
```{r}
train_quant <- train %>%
  select_if(is.numeric)

model <- lm(SalePrice ~ ., train_quant)
model %>% summary

model_pred <- model %>%
  predict(newdata=test)

RMSE(model_pred, test$SalePrice)
```
# Num as Quant
```{r}
train <- set_numerics(train, num_vars)

model.train <- train %>% select_if(is.numeric)

model <- lm(SalePrice~., model.train)
model %>% summary

test <- set_numerics(test, num_vars)
model_pred <- predict(model, newdata = test)

RMSE(model_pred, test$SalePrice)
```
```{r}
train

```

# With preproc - all
```{r}
train <- train %>% preprocessing()
train <- train %>% factorize()

model <- lm(SalePrice ~., train)
model %>% summary()

test <- test %>% set_numerics(num_vars)
test <- test %>% preprocessing()
test <- test %>% factorize

model_pred <- predict(model, newdata=test)

RMSE(model_pred, test$SalePrice)
```

```{r}
train <- init_train
train <- train %>% set_numerics(num_vars)
train <- train %>% preprocessing
train <- train %>% factorize

sel_vars <- train %>% colnames %>% sample(20, replace=F)

formula <- paste(target, '~', sep = " ")
for(i in seq_along(sel_vars)){
  ifelse(i==1,
         formula <- paste(formula, sel_vars[i], sep = ' '),
         formula <- paste(formula, sel_vars[i], sep = ' + '))
}; rm(i)
formula <- as.formula(formula)
formula

model0 <- lm(formula, train)
model0 %>% summary

stepAIC(model0, direction='both', trace=T)
```




